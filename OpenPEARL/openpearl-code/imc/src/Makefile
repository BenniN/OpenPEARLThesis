include ../../configuration/include/auto.conf


.PHONY: all clean tests

all: imc.jar

SRCS = InstallationLocation.java \
	InterModuleChecker.java TargetPlatformXml.java ModuleXml.java\
	ReadXml.java \
	SystemEntries.java SystemEntry.java Parameter.java Error.java \
	CodeGenerator.java AssociationEntry.java

%.class: %.java
	javac $<

CLASSES = $(SRCS:.java=.class)

imc.jar:  $(CLASSES)
	jar cfe imc.jar default.InterModuleChecker.class $(CLASSES) 

InterModuleChecker.class: InterModuleChecker.java
	javac InterModuleChecker.java

InstallationLocation.java: ../../configuration/include/auto.conf
	echo "// [auto generated by make] " > InstallationLocation.java
	echo "class InstallationLocation {" >> InstallationLocation.java
	echo " public static String path=\""$(CONFIG_INSTALL_Target)"\";" >> InstallationLocation.java
	echo "};" >> InstallationLocation.java

clean:
	rm -f InstallationLocation.java
	rm -f ../imc.inc
	rm -f $(CLASSES)
	rm -f imc.jar 

install: imc.jar
	cp imc.jar $(CONFIG_INSTALL_Target)/bin/imc.jar
	echo 'java -cp $(CONFIG_INSTALL_Target)/bin/imc.jar InterModuleChecker -b $$PLATTFORM  -o system.cc $$fn' > ../imc.inc

prepare:
	touch $(CONFIG_INSTALL_Target)/bin/imc.jar
	chmod 777  $(CONFIG_INSTALL_Target)/bin/imc.jar

tests:
	(cd tests; make;)
